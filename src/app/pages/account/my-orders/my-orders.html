<section>
  <div class="container mx-auto px-4 py-8">
    <h5 class="text-3xl font-bold mb-6">My Orders</h5>
  </div>
  <div class="overflow-x-auto">
    <table class="w-full text-sm">
      <thead>
        <tr class="bg-gray-100 border-b">
          <th class="px-4 py-3 text-left">Order ID</th>
          <th class="px-4 py-3 text-left">Customer</th>
          <th class="px-4 py-3 text-left">Amount</th>
          <th class="px-4 py-3 text-left">Order Status</th>
          <th class="px-4 py-3 text-left">Payment</th>
          <th class="px-4 py-3 text-left">Date</th>
          <th class="px-4 py-3 text-left">Actions</th>
        </tr>
      </thead>
      @if (loading()) {
        <tr>
          <td colspan="6" class="text-center py-4">
            <app-loader></app-loader>
          </td>
        </tr>
      } @else {
        <tbody>
          @if (orderList().length === 0) {
            <tr>
              <td colspan="8" class="text-center py-6 text-gray-500">
                <div class="flex items-center justify-center flex-col gap-2 text-[10rem]">
                  <i class="fa fa-briefcase text-gray-400"></i>
                  <h4 class="text-2xl font-semibold">Your Order is Empty</h4>
                </div>
              </td>
            </tr>
          } @else {
            @for (order of orderList(); track $index) {
              <tr class="border-b hover:bg-gray-50">
                <td class="px-4 py-3 font-semibold">{{ order.orderNumber }}</td>
                <td class="px-4 py-3">
                  <div>
                    <p class="font-semibold">{{ order.customerName }}</p>
                    <p class="text-gray-500 text-xs">{{ order.customerEmail }}</p>
                  </div>
                </td>
                <td class="px-4 py-3 font-semibold">${{ order.total | number: '1.2-2' }}</td>
                <td class="px-4 py-3">
                  <span
                    [class]="getStatusColor(order.orderStatus)"
                    class="px-3 py-1 rounded-full text-xs font-semibold"
                  >
                    {{ order.orderStatus | uppercase }}
                  </span>
                </td>
                <td class="px-4 py-3">
                  <span
                    [class]="getPaymentColor(order.paymentStatus)"
                    class="px-3 py-1 rounded-full text-xs font-semibold"
                  >
                    {{ order.paymentStatus | uppercase }}
                  </span>
                </td>
                <td class="px-4 py-3">{{ order.createdAt | date: 'short' }}</td>
                <td class="px-4 py-3">
                  <div class="flex gap-2">
                    <button
                      (click)="selectedOrder = order"
                      class="text-blue-600 hover:text-blue-800 font-semibold"
                    >
                      View
                    </button>
                    <button
                      (click)="cancelOrder(order.$id)"
                      class="text-red-600 hover:text-red-800 font-semibold"
                    >
                      Cancel
                    </button>
                  </div>
                </td>
              </tr>
            }
          }
        </tbody>
      }
    </table>
  </div>
</section>

<!-- Order Detail Modal -->
@if (selectedOrder) {
  <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-900">
    <div class="bg-white rounded-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
      <div class="p-6 border-b flex justify-between items-center">
        <h2 class="text-2xl font-bold">Order Details</h2>
        <button (click)="selectedOrder = null" class="text-gray-500 hover:text-gray-700 text-2xl">
          ‚úï
        </button>
      </div>

      <div class="p-6 space-y-4">
        <!-- Order Header -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <p class="text-gray-600 text-sm">Order Number</p>
            <p class="text-lg font-semibold">{{ selectedOrder.orderNumber }}</p>
          </div>
          <div>
            <p class="text-gray-600 text-sm">Order Date</p>
            <p class="text-lg font-semibold">
              {{ selectedOrder.createdAt | date: 'short' }}
            </p>
          </div>
        </div>

        <!-- Customer Info -->
        <div class="bg-gray-50 rounded-lg p-4">
          <h3 class="font-semibold text-gray-800 mb-2">Customer Information</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <p class="text-gray-600 text-sm">Customer Name</p>
              <p class="font-semibold">{{ selectedOrder.customerName }}</p>
            </div>
            <div>
              <p class="text-gray-600 text-sm">Email</p>
              <p class="font-semibold">{{ selectedOrder.customerEmail }}</p>
            </div>
          </div>
        </div>

        <!-- Order Items -->
        <div>
          <h3 class="font-semibold text-gray-800 mb-2">Order Items</h3>
          <table class="w-full text-sm border-collapse">
            <thead>
              <tr class="bg-gray-100 border">
                <th class="px-3 py-2 text-left">Product</th>
                <th class="px-3 py-2 text-center">Quantity</th>
                <th class="px-3 py-2 text-right">Price</th>
                <th class="px-3 py-2 text-right">Total</th>
              </tr>
            </thead>
            <tbody>
              @for (item of selectedOrder.items; track $index) {
                <tr class="border">
                  <td class="px-3 py-2">{{ item.productName }}</td>
                  <td class="px-3 py-2 text-center">{{ item.quantity }}</td>
                  <td class="px-3 py-2 text-right">${{ item.price | number: '1.2-2' }}</td>
                  <td class="px-3 py-2 text-right">${{ item.subtotal | number: '1.2-2' }}</td>
                </tr>
              }
              <tr class="bg-gray-100 border font-semibold">
                <td colspan="3" class="px-3 py-2 text-right">Total:</td>
                <td class="px-3 py-2 text-right">${{ selectedOrder.total | number: '1.2-2' }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Shipping Address -->
        <div class="bg-gray-50 rounded-lg p-4">
          <h3 class="font-semibold text-gray-800 mb-2">Shipping Address</h3>
          <p>{{ selectedOrder.customerAddress }}</p>
          <p></p>
          <p class="text-gray-600">{{ selectedOrder.customerPhone }}</p>
        </div>

        <!-- Order Status -->
        <div>
          <span>Order Status:</span>
          <span
            [class]="getStatusColor(selectedOrder.orderStatus)"
            class="px-3 py-1 rounded-full text-xs font-semibold"
          >
            {{ selectedOrder.orderStatus | uppercase }}
          </span>
        </div>

        <!-- Actions -->
        <div class="flex gap-2 pt-4">
          <button
            (click)="printOrder()"
            class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
          >
            üñ®Ô∏è Print
          </button>
          <button
            (click)="selectedOrder = null"
            class="flex-1 bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500 transition"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
}
